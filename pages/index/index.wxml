<!-- index.wxml -->
<navigation-bar
  title="Echo Map"
  back="{{false}}"
  color="black"
  background="#FFF"
/>

<view class="page-body">
  <!-- 地图 -->
  <map
    class="map"
    id="map"
    longitude="{{center.longitude}}"
    latitude="{{center.latitude}}"
    scale="{{scale}}"
    bindtap="onMapTap"
    bindpoitap="onPoiTap"
    show-location="true"
  />

  <!-- 底部弹窗 (非阻塞式) -->
  <view class="bottom-sheet {{bottomSheetVisible ? 'bottom-sheet--show' : ''}}">
    <!-- 关闭箭头 -->
    <view class="bottom-sheet__header" bindtap="onCloseBottomSheet">
      <view class="icon-arrow-down"></view>
    </view>

    <scroll-view class="bottom-sheet-content" scroll-y="true">
      <view class="info-title">{{selectedLocation.name}}</view>
      <view class="info-row">省份：{{selectedLocation.province || '解析中...'}}</view>
      <view class="info-row">经纬度：{{selectedLocation.longitude}} {{selectedLocation.latitude}}</view>
      
      <!-- 城市推荐 -->
      <block wx:if="{{cityImages.length > 0}}">
        <view class="section-title">城市推荐</view>
        <view class="info-image-row">
          <image
            wx:for="{{cityImages}}"
            wx:key="*this"
            class="info-image"
            src="{{item}}"
            mode="aspectFill"
            data-index="{{index}}"
            data-type="city"
            bindtap="onImagePreview"
          />
        </view>
      </block>

      <!-- 省份推荐 -->
      <block wx:if="{{provinceImages.length > 0}}">
        <view class="section-title">省份推荐</view>
        <view class="info-image-row">
          <image
            wx:for="{{provinceImages}}"
            wx:key="*this"
            class="info-image"
            src="{{item}}"
            mode="aspectFill"
            data-index="{{index}}"
            data-type="province"
            bindtap="onImagePreview"
          />
        </view>
      </block>
    </scroll-view>
  </view>
</view>
